# üì® ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° Backend

## üî¥ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠

Frontend ‡πÄ‡∏à‡∏≠ **429 Rate Limit Error** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á Orders ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Report ‡∏ù‡∏±‡πà‡∏á Client

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Error:**
```
GET https://staging-finance-backoffice-report-api.vercel.app/api/orders net::ERR_FAILED
Access to fetch has been blocked by CORS policy
```

---

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

Backend ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á **7 Report Endpoints** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á Server ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤

---

## üìã Endpoints ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á

### 1. ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
```
GET /api/reports/summary
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: total_orders, total_customers, total_net_amount, avg_net_amount

### 2. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
```
GET /api/reports/by-country
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### 3. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° Supplier
```
GET /api/reports/by-supplier
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Supplier ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### 4. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
```
GET /api/reports/by-travel-date
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### 5. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≠‡∏á
```
GET /api/reports/by-booking-date
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### 6. ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥
```
GET /api/reports/repeat-customers
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### 7. ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
```
GET /api/reports/countries
```
‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö: Array ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)

---

## üîë Parameters ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö (‡∏ó‡∏∏‡∏Å Endpoint ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô countries)

```
travel_date_from    - ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (YYYY-MM-DD)
travel_date_to      - ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (YYYY-MM-DD)
booking_date_from   - ‡∏ß‡∏±‡∏ô‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (YYYY-MM-DD)
booking_date_to     - ‡∏ß‡∏±‡∏ô‡∏à‡∏≠‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (YYYY-MM-DD)
country_id          - ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
supplier_id         - ‡∏£‡∏´‡∏±‡∏™ Supplier
```

**‡∏ó‡∏∏‡∏Å parameter ‡πÄ‡∏õ‡πá‡∏ô optional**

---

## üì§ Response Format (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)

### ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
```json
{
  "success": true,
  "data": [...]
}
```

### ‚ùå ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
```json
{
  "status": "success",
  "data": [...]
}
```

---

## üîê Authentication

‡∏ó‡∏∏‡∏Å Request ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Header:
```
x-api-key: <token>
```

---

## üåê CORS Configuration

### ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Origins:
```
http://localhost:3000
http://localhost:3001
https://staging-finance-backoffice-report.vercel.app
https://finance-backoffice-report.vercel.app
```

### ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Headers:
```
Content-Type
x-api-key
```

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° `x-api-key` ‡πÉ‡∏ô allowed headers ‡∏î‡πâ‡∏ß‡∏¢!

---

## üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®

‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å field `product_snapshot` ‡πÉ‡∏ô Orders table:

```json
{
  "country": {
    "id": "TH",
    "name_th": "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢",
    "name_en": "Thailand"
  }
}
```

---

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ

1. **BACKEND_QUICK_START.md** 
   - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô (‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô‡πÜ)

2. **BACKEND_API_REQUIREMENTS_TH.md**
   - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢

3. **BACKEND_API_REQUIREMENTS.md**
   - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©

4. **BACKEND_SQL_EXAMPLES.md**
   - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á SQL Queries ‡∏û‡∏£‡πâ‡∏≠‡∏° Helper Functions

---

## ‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. ‚úÖ ‡πÉ‡∏ä‡πâ `success: true` ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà `status: "success"`
2. ‚úÖ ‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 records (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô countries/suppliers)
3. ‚úÖ ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏à‡∏≤‡∏Å `product_snapshot` JSON field
4. ‚úÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ + ‡∏õ‡∏µ ‡∏û.‡∏®. (‡πÄ‡∏ä‡πà‡∏ô "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568")
5. ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° `x-api-key` ‡πÉ‡∏ô CORS allowed headers
6. ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö (null/undefined)

---

## üß™ Testing

Test Tokens:
```
sk_test_4f8b2c9e1a3d5f7b9c0e2a4d6f8b1c3e
sk_test_9a7b5c3d1e2f4a6b8c0d2e4f6a8b0c2d
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ:
```bash
curl -X GET "https://staging-finance-backoffice-report-api.vercel.app/api/reports/summary" \
  -H "x-api-key: sk_test_4f8b2c9e1a3d5f7b9c0e2a4d6f8b1c3e"
```

---

## ‚úÖ Checklist

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á 7 Endpoints ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
- [ ] ‡πÉ‡∏ä‡πâ `success: true` ‡πÉ‡∏ô Response
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS (4 origins)
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° `x-api-key` ‡πÉ‡∏ô allowed headers
- [ ] ‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 records (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô countries/suppliers)
- [ ] ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏à‡∏≤‡∏Å `product_snapshot`
- [ ] ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ + ‡∏û.‡∏®.
- [ ] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å endpoint
- [ ] Deploy ‡∏Ç‡∏∂‡πâ‡∏ô staging
- [ ] ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏° Frontend ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

---

## üéØ Priority

üî¥ **High Priority** - Frontend ‡∏£‡∏≠ endpoints ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 429 Error

---

## üìÖ Timeline

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà Frontend ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö

---

**‡∏™‡∏£‡∏∏‡∏õ:** Backend ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á 7 Report Endpoints ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á Server ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ Frontend ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏≠‡∏á

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:** ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 429 Rate Limit Error ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Report ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô

---

**Created:** 2025-01-14
**Version:** 1.0
