# ðŸ› à¸£à¸²à¸¢à¸‡à¸²à¸™à¸šà¸±à¹Šà¸: à¸à¸²à¸£ Filter à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™

**à¸§à¸±à¸™à¸—à¸µà¹ˆ:** 14 à¸¡à¸à¸£à¸²à¸„à¸¡ 2026  
**à¸„à¸§à¸²à¸¡à¸ªà¸³à¸„à¸±à¸:** à¸ªà¸¹à¸‡  
**à¸ªà¸–à¸²à¸™à¸°:** à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚

---

## ðŸ“‹ à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¸›à¸±à¸à¸«à¸²

à¹€à¸¡à¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸¥à¸·à¸­à¸ Filter à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸—à¸¨ (country_id) à¹à¸¥à¹‰à¸§à¸à¸”à¸„à¹‰à¸™à¸«à¸² API endpoint `/api/reports/by-country` **à¸¢à¸±à¸‡à¸„à¸‡ return à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨** à¹à¸—à¸™à¸—à¸µà¹ˆà¸ˆà¸° filter à¹€à¸‰à¸žà¸²à¸°à¸›à¸£à¸°à¹€à¸—à¸¨à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸

### à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡
à¹€à¸¡à¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸¥à¸·à¸­à¸ "à¸à¸£à¸µà¸‹" (country_id = 89):
- Summary à¸„à¸§à¸£à¹à¸ªà¸”à¸‡: 1 Order, 1 à¸¥à¸¹à¸à¸„à¹‰à¸², à¸¿830,000 âœ… (à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)
- à¸à¸£à¸²à¸Ÿà¸„à¸§à¸£à¹à¸ªà¸”à¸‡: **à¹€à¸‰à¸žà¸²à¸°à¸à¸£à¸µà¸‹** âŒ (à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™)
- à¸•à¸²à¸£à¸²à¸‡à¸„à¸§à¸£à¹à¸ªà¸”à¸‡: **à¹€à¸‰à¸žà¸²à¸°à¸à¸£à¸µà¸‹** âŒ (à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™)

### à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¸ˆà¸£à¸´à¸‡
- Summary à¸–à¸¹à¸ filter à¹à¸¥à¹‰à¸§ âœ…
- à¸à¸£à¸²à¸Ÿà¹à¸ªà¸”à¸‡**à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨** (à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™, à¹€à¸§à¸µà¸¢à¸”à¸™à¸²à¸¡, à¸à¸£à¸µà¸‹, à¸¯à¸¥à¸¯) âŒ
- à¸•à¸²à¸£à¸²à¸‡à¹à¸ªà¸”à¸‡**à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨** âŒ

---

## ðŸ” à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸—à¸²à¸‡à¹€à¸—à¸„à¸™à¸´à¸„

### Frontend à¸ªà¹ˆà¸‡ Request
```
GET /api/reports/by-country?country_id=89
Headers:
  x-api-key: sk_test_...
```

### Backend Response à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸œà¸´à¸”)
```json
{
  "success": true,
  "data": [
    { "country_name": "à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™", "total_orders": 462, ... },
    { "country_name": "à¹€à¸§à¸µà¸¢à¸”à¸™à¸²à¸¡", "total_orders": 234, ... },
    { "country_name": "à¸à¸£à¸µà¸‹", "total_orders": 1, ... },
    { "country_name": "à¹€à¸à¸²à¸«à¸¥à¸µ", "total_orders": 45, ... },
    // ... return à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨
  ]
}
```

### Backend Response à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ (à¸„à¸§à¸£à¹€à¸›à¹‡à¸™)
```json
{
  "success": true,
  "data": [
    { 
      "country_name": "à¸à¸£à¸µà¸‹", 
      "total_orders": 1, 
      "total_customers": 1, 
      "total_net_amount": 830000, 
      "avg_net_amount": 830000 
    }
  ]
}
```

---

## ðŸ› ï¸ à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³

### Endpoints à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸œà¸¥à¸à¸£à¸°à¸—à¸š
à¸—à¸¸à¸ report endpoint à¸•à¹‰à¸­à¸‡ filter à¸•à¸²à¸¡ `country_id`:

1. âœ… `/api/reports/summary` - à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹à¸¥à¹‰à¸§
2. âŒ `/api/reports/by-country` - **à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚**
3. âŒ `/api/reports/by-supplier` - **à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚**
4. âŒ `/api/reports/by-travel-date` - **à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚**
5. âŒ `/api/reports/by-booking-date` - **à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚**
6. âŒ `/api/reports/repeat-customers` - **à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚**

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚ SQL

**SQL à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸œà¸´à¸”):**
```sql
SELECT 
  c.name_th as country_name,
  COUNT(DISTINCT o.id) as total_orders,
  COUNT(DISTINCT o.customer_id) as total_customers,
  SUM(o.net_amount) as total_net_amount,
  AVG(o.net_amount) as avg_net_amount
FROM orders o
LEFT JOIN countries c ON o.country_id = c.id
GROUP BY c.id, c.name_th
ORDER BY total_orders DESC
```

**SQL à¸—à¸µà¹ˆà¹à¸à¹‰à¹„à¸‚à¹à¸¥à¹‰à¸§ (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡):**
```sql
SELECT 
  c.name_th as country_name,
  COUNT(DISTINCT o.id) as total_orders,
  COUNT(DISTINCT o.customer_id) as total_customers,
  SUM(o.net_amount) as total_net_amount,
  AVG(o.net_amount) as avg_net_amount
FROM orders o
LEFT JOIN countries c ON o.country_id = c.id
WHERE 1=1
  -- à¹€à¸žà¸´à¹ˆà¸¡ filter à¸›à¸£à¸°à¹€à¸—à¸¨ (à¸–à¹‰à¸²à¸¡à¸µ)
  AND (@country_id IS NULL OR o.country_id = @country_id)
  -- à¹€à¸žà¸´à¹ˆà¸¡ filter supplier (à¸–à¹‰à¸²à¸¡à¸µ)
  AND (@supplier_id IS NULL OR o.supplier_id = @supplier_id)
  -- à¹€à¸žà¸´à¹ˆà¸¡ filter à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸”à¸´à¸™à¸—à¸²à¸‡ (à¸–à¹‰à¸²à¸¡à¸µ)
  AND (@travel_date_from IS NULL OR o.travel_date >= @travel_date_from)
  AND (@travel_date_to IS NULL OR o.travel_date <= @travel_date_to)
  -- à¹€à¸žà¸´à¹ˆà¸¡ filter à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸­à¸‡ (à¸–à¹‰à¸²à¸¡à¸µ)
  AND (@booking_date_from IS NULL OR o.booking_date >= @booking_date_from)
  AND (@booking_date_to IS NULL OR o.booking_date <= @booking_date_to)
GROUP BY c.id, c.name_th
ORDER BY total_orders DESC
```

---

## ðŸ“ Checklist à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚

### à¸ªà¸³à¸«à¸£à¸±à¸š `/api/reports/by-country`
- [ ] à¸£à¸±à¸š parameter `country_id` à¸ˆà¸²à¸ query string
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clause: `o.country_id = @country_id` (à¸–à¹‰à¸²à¸¡à¸µà¸„à¹ˆà¸²)
- [ ] à¸£à¸±à¸š parameter `supplier_id` à¸ˆà¸²à¸ query string
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clause: `o.supplier_id = @supplier_id` (à¸–à¹‰à¸²à¸¡à¸µà¸„à¹ˆà¸²)
- [ ] à¸£à¸±à¸š parameters à¸§à¸±à¸™à¸—à¸µà¹ˆ (travel_date_from, travel_date_to, etc.)
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clauses à¸ªà¸³à¸«à¸£à¸±à¸š filter à¸§à¸±à¸™à¸—à¸µà¹ˆ
- [ ] à¸—à¸”à¸ªà¸­à¸š filter à¸›à¸£à¸°à¹€à¸—à¸¨à¹€à¸”à¸µà¸¢à¸§
- [ ] à¸—à¸”à¸ªà¸­à¸š filter à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¸£à¸§à¸¡à¸à¸±à¸™

### à¸ªà¸³à¸«à¸£à¸±à¸š `/api/reports/by-supplier`
- [ ] à¸£à¸±à¸š parameter `country_id`
- [ ] à¸£à¸±à¸š parameter `supplier_id`
- [ ] à¸£à¸±à¸š parameters à¸§à¸±à¸™à¸—à¸µà¹ˆ
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clauses à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- [ ] à¸—à¸”à¸ªà¸­à¸š filters

### à¸ªà¸³à¸«à¸£à¸±à¸š `/api/reports/by-travel-date`
- [ ] à¸£à¸±à¸š parameter `country_id`
- [ ] à¸£à¸±à¸š parameter `supplier_id`
- [ ] à¸£à¸±à¸š parameters à¸§à¸±à¸™à¸—à¸µà¹ˆ
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clauses à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- [ ] à¸—à¸”à¸ªà¸­à¸š filters

### à¸ªà¸³à¸«à¸£à¸±à¸š `/api/reports/by-booking-date`
- [ ] à¸£à¸±à¸š parameter `country_id`
- [ ] à¸£à¸±à¸š parameter `supplier_id`
- [ ] à¸£à¸±à¸š parameters à¸§à¸±à¸™à¸—à¸µà¹ˆ
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clauses à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- [ ] à¸—à¸”à¸ªà¸­à¸š filters

### à¸ªà¸³à¸«à¸£à¸±à¸š `/api/reports/repeat-customers`
- [ ] à¸£à¸±à¸š parameter `country_id`
- [ ] à¸£à¸±à¸š parameter `supplier_id`
- [ ] à¸£à¸±à¸š parameters à¸§à¸±à¸™à¸—à¸µà¹ˆ
- [ ] à¹€à¸žà¸´à¹ˆà¸¡ WHERE clauses à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- [ ] à¸—à¸”à¸ªà¸­à¸š filters

---

## ðŸ§ª Test Cases

### Test Case 1: Filter à¹€à¸‰à¸žà¸²à¸°à¸›à¸£à¸°à¹€à¸—à¸¨
```
Request: GET /api/reports/by-country?country_id=89
à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡: return à¹€à¸‰à¸žà¸²à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸£à¸µà¸‹
```

### Test Case 2: Filter à¸›à¸£à¸°à¹€à¸—à¸¨ + à¸Šà¹ˆà¸§à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ
```
Request: GET /api/reports/by-country?country_id=89&travel_date_from=2024-01-01&travel_date_to=2024-12-31
à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡: return à¹€à¸‰à¸žà¸²à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸£à¸µà¸‹à¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”
```

### Test Case 3: Filter à¸›à¸£à¸°à¹€à¸—à¸¨ + Supplier
```
Request: GET /api/reports/by-country?country_id=89&supplier_id=5
à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡: return à¹€à¸‰à¸žà¸²à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸£à¸µà¸‹à¸‚à¸­à¸‡ supplier à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
```

### Test Case 4: à¹„à¸¡à¹ˆà¸¡à¸µ Filter
```
Request: GET /api/reports/by-country
à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡: return à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨ (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡)
```

---

## ðŸ“Š Parameters à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸­à¸‡à¸£à¸±à¸š

à¸—à¸¸à¸ report endpoint à¸„à¸§à¸£à¸£à¸±à¸š parameters à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰:

| Parameter | Type | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ | à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ |
|-----------|------|----------|----------|
| `country_id` | integer | Filter à¸•à¸²à¸¡ ID à¸›à¸£à¸°à¹€à¸—à¸¨ | `89` |
| `supplier_id` | integer | Filter à¸•à¸²à¸¡ ID supplier | `5` |
| `travel_date_from` | date | à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ | `2024-01-01` |
| `travel_date_to` | date | à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” | `2024-12-31` |
| `booking_date_from` | date | à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸­à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ | `2024-01-01` |
| `booking_date_to` | date | à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸­à¸‡à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” | `2024-12-31` |

---

## ðŸ”— à¹€à¸­à¸à¸ªà¸²à¸£à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡

- à¸”à¸¹ `BACKEND_API_REQUIREMENTS.md` à¸ªà¸³à¸«à¸£à¸±à¸š API specifications à¹à¸šà¸šà¹€à¸•à¹‡à¸¡
- à¸”à¸¹ `BACKEND_API_REQUIREMENTS_TH.md` à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸­à¸à¸ªà¸²à¸£à¸ à¸²à¸©à¸²à¹„à¸—à¸¢
- à¸”à¸¹ `BACKEND_SQL_EXAMPLES.md` à¸ªà¸³à¸«à¸£à¸±à¸šà¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ SQL queries
- Frontend code: `order-report-api.js` (à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ buildQueryString)

---

## âš ï¸ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸ªà¸³à¸„à¸±à¸

1. **Filters à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸›à¹‡à¸™ optional** - à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡à¸¡à¸² à¹ƒà¸«à¹‰ return à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
2. **Filters à¸•à¹‰à¸­à¸‡à¸—à¸³à¸‡à¸²à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™à¹„à¸”à¹‰** - à¸«à¸¥à¸²à¸¢ filters à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ AND logic
3. **Summary endpoint à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹à¸¥à¹‰à¸§** - à¹ƒà¸Šà¹‰à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡
4. **à¸£à¸¹à¸›à¹à¸šà¸šà¸§à¸±à¸™à¸—à¸µà¹ˆ:** `YYYY-MM-DD` (à¹€à¸Šà¹ˆà¸™ `2024-01-15`)
5. **à¸£à¸¹à¸›à¹à¸šà¸š Response à¸•à¹‰à¸­à¸‡à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡** - à¹à¸„à¹ˆ filter à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ structure

---

## ðŸ“¸ Screenshot à¸›à¸±à¸à¸«à¸²

à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸›à¸£à¸°à¹€à¸—à¸¨ "à¸à¸£à¸µà¸‹":
- Summary à¹à¸ªà¸”à¸‡: 1 Order âœ…
- à¸à¸£à¸²à¸Ÿà¹à¸ªà¸”à¸‡: à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸—à¸¨ (à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™ 462, à¹€à¸§à¸µà¸¢à¸”à¸™à¸²à¸¡ 234, à¸à¸£à¸µà¸‹ 1, à¸¯à¸¥à¸¯) âŒ
- à¸„à¸§à¸£à¹à¸ªà¸”à¸‡à¹€à¸‰à¸žà¸²à¸°: à¸à¸£à¸µà¸‹ 1 Order

---

## ðŸ“ž à¸•à¸´à¸”à¸•à¹ˆà¸­

à¸«à¸²à¸à¸¡à¸µà¸„à¸³à¸–à¸²à¸¡à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¸£à¸²à¸¢à¸‡à¸²à¸™à¸šà¸±à¹Šà¸à¸™à¸µà¹‰ à¸à¸£à¸¸à¸“à¸²à¸•à¸´à¸”à¸•à¹ˆà¸­à¸—à¸µà¸¡ Frontend

**à¸§à¸±à¸™à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸‡à¸²à¸™:** 14 à¸¡à¸à¸£à¸²à¸„à¸¡ 2026
